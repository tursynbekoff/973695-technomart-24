!function(t){function e(e){for(var i,n,l=e[0],a=e[1],p=e[2],_=0,d=[];_<l.length;_++)n=l[_],o[n]&&d.push(o[n][0]),o[n]=0;for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i]);for(h&&h(e);d.length;)d.shift()();return r.push.apply(r,p||[]),s()}function s(){for(var t,e=0;e<r.length;e++){for(var s=r[e],i=!0,l=1;l<s.length;l++){var a=s[l];0!==o[a]&&(i=!1)}i&&(r.splice(e--,1),t=n(n.s=s[0]))}return t}var i={},o={"web/poster":0},r=[];function n(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=i,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var l=window.webpackJsonp=window.webpackJsonp||[],a=l.push.bind(l);l.push=e,l=l.slice();for(var p=0;p<l.length;p++)e(l[p]);var h=a;r.push([111,"common"]),s()}({111:function(t,e,s){t.exports=s("OL9c")},OL9c:function(t,e,s){"use strict";s.r(e);var i=s("EasH"),o=s("Egk5");var r=window,n=r.lockButton,l=r.unlockButton,a=r.geByClass1,p=r.getRGB,h=r.isFunction,_=r.KEY,d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._onSubmitCallback=e.onSubmit,this._placeholderText=e.placeholder,this._initCallbacks(e)}return t.prototype.show=function(){var t={oid:this._getPostOwnerId(),act:"upload_bkg_box"},e={containerClass:"poster-uploader",params:{hideButtons:!0,width:655,onDestroy:this._onLayerDestroy.bind(this)},onDone:this._onShowBoxDone.bind(this)};this.box=Object(i.b)("al_poster.php",t,e)},t.prototype.hide=function(){this.box.hide()},t.prototype._init=function(t,e){t.isVisible()&&(this._initElements(t.bodyNode),this._initListeners(),this._initUpload(e),this._initDragAndDrop())},t.prototype._initElements=function(t){this._els={},this._els.dropBox=a("poster-uploader__drop-box",t),this._els.dropArrowBtn=a("poster-uploader__arrow-btn",t),this._els.dropWrapper=a("poster-uploader__drop-area",t),this._els.editWrapper=a("poster-uploader__background-edit",t),this._els.closeBtn=ge("poster-uploader-close-btn"),this._els.uploadInput=ge("poster-uploader-file-input"),this._els.uploadMainInput=ge("poster-uploader-main-file-input"),this._els.status=ge("poster-uploader-status"),this._els.posterView=a("poster__image",t),this._els.posterTextEl=a("poster__text",t),this._els.overlay=a("poster-uploader__overlay",t),this._els.pickerItem=a("poster-color-ctrl__picker",t),this._els.pickerInput=ge("poster-color-picker"),this._els.pickerTextInput=ge("poster-color-input"),this._els.pickerTextInputWrapper=a("poster-color-ctrl__color-input-wrapper",t),this._els.gallery=a("poster-color-ctrl__gallery",t),this._els.saveBtn=a("poster-uploader__save",t),this._els.cancelBtn=a("poster-uploader__cancel",t),this._isColorPickerSupport()||(re(this._els.pickerItem),show(this._els.pickerTextInputWrapper)),this._swipeColorItem(this._els.gallery.firstElementChild),this._updateText()},t.prototype._initListeners=function(){var t=this;this._handlersForDestroy=[];var e=function(){t.hide()},s=function(){t._els.uploadInput.click()},i=this._submit.bind(this),r=function(e){var s=e.target.files;t._uploadToModel(s)},n=this._onColorItemClick.bind(this);if(Object(o.b)(this._els.uploadInput,"change",r),Object(o.b)(this._els.saveBtn,"click",i),Object(o.b)(this._els.closeBtn,"click",e),Object(o.b)(this._els.cancelBtn,"click",function(){hide(t._els.editWrapper),show(t._els.dropWrapper),t._files=null,t._els.pickerInput.value="",t._els.pickerTextInput.value="",t._els.uploadInput.value=null,t._swipeColorItem(t._els.gallery.firstElementChild)}),Object(o.b)(this._els.dropBox,"click",s),Object(o.b)(this._els.dropArrowBtn,"click",s),Object(o.b)(this._els.gallery,"click",n),this._handlersForDestroy.push(function(){Object(o.h)(t._els.dropArrowBtn,"click",s),Object(o.h)(t._els.gallery,"click",n),Object(o.h)(t._els.uploadInput,"change",r),Object(o.h)(t._els.closeBtn,"click",e),Object(o.h)(t._els.dropBox,"click",s)}),this._isColorPickerSupport()){var l=function(){t._swipeColorItem(t._els.pickerItem,t._els.pickerInput.value),t._els.pickerItem.style.backgroundColor=t._els.pickerInput.value},a=function(){t._els.pickerInput.click()};Object(o.b)(this._els.pickerInput,"input",l),Object(o.b)(this._els.pickerItem,"click",a),this._handlersForDestroy.push(function(){Object(o.h)(t._els.pickerInput,"input",l),Object(o.h)(t._els.pickerItem,"click",a)})}else{var p=function(e){if(!i(e)){var s=String.fromCharCode(e.keyCode);(i(e)||/^[a-f0-9]$/i.test(s))&&(t._els.pickerInput.focus(),document.execCommand("insertText",!1,s)),cancelEvent(e)}function i(t){return t.keyCode===_.DEL||t.keyCode===_.UP||t.keyCode===_.RIGHT||t.keyCode===_.LEFT||t.keyCode===_.DOWN||46===t.keyCode||t.ctrlKey||t.metaKey}},h=function(){var e="#"+t._els.pickerTextInput.value.toUpperCase();/^#([0-9a-f]{3}){1,2}$/i.test(e)&&t._swipeColorItem(t._els.pickerTextInput,e),"#"===e&&t._swipeColorItem(t._els.pickerTextInput,"#fff")},d=function(t){var e=trim(t.clipboardData.getData("Text")).toUpperCase();"#"===e[0]&&(e=e.slice(1)),/^[a-f0-9]{1,6}$/i.test(e)&&document.execCommand("insertText",!1,e),cancelEvent(t)};Object(o.b)(this._els.pickerTextInput,"paste",d),Object(o.b)(this._els.pickerTextInput,"keydown",p),Object(o.b)(this._els.pickerTextInput,"input",h),this._handlersForDestroy.push(function(){Object(o.h)(t._els.pickerTextInput,"paste",d),Object(o.h)(t._els.pickerTextInput,"keydown",p),Object(o.h)(t._els.pickerTextInput,"input",h)})}},t.prototype._initCallbacks=function(t){h(t.onHide)&&(this._onHideCallback=t.onHide),h(t.getExampleText)&&(this._getExampleText=t.getExampleText),h(t.getPostOwnerId)?this._getPostOwnerId=t.getPostOwnerId:this._getPostOwnerId=function(){return cur.oid}},t.prototype._updateColor=function(t){var e=p(t);function s(t){var e=t.toString(16);return 1===e.length?"0"+e:e}this._textColor=function(t,e,i){return"#"+s(t)+s(e)+s(i)}.apply(void 0,function(t){if(Array.isArray(t)){for(var e=0,s=Array(t.length);e<t.length;e++)s[e]=t[e];return s}return Array.from(t)}(e)),this._els.posterTextEl.style.color=this._textColor,this._isColorPickerSupport()&&(this._els.pickerInput.value=this._textColor)},t.prototype._initUpload=function(t){var e=this._getUploadParams(t);this._files=null,this._minImageSizesArr=t.min_image_sizes,this.uploadId=Upload.init(this._els.uploadMainInput,t.url,{},e)},t.prototype._uploadToBackend=function(){Upload.onFileApiSend(this.uploadId,this._files)},t.prototype._uploadToModel=function(t){if(t.length)if(t.length>1)Object(i.d)(getLang("global_error"),getLang("wall_poster_upload_wrong_number_image"));else if(this._isFileTypeValid(t[0].name)){var e=t[0],s=new FileReader,o=this;s.onload=function(){o._checkImageSizes(s.result,function(){o._files=t,o._els.posterView.style.backgroundImage='url("'+s.result+'")',hide(o._els.dropWrapper),show(o._els.editWrapper)},function(){Object(i.d)(getLang("global_error"),getLang("wall_poster_upload_wrong_image_size"))})},s.readAsDataURL(e)}else Object(i.d)(getLang("global_error"),getLang("wall_poster_upload_wrong_type_file"))},t.prototype._checkImageSizes=function(t,e,s){var i=new Image,o=this;i.onload=function(){this.width<o._minImageSizesArr[0]||this.height<o._minImageSizesArr[1]?s():e()},i.src=t},t.prototype._submit=function(){this._uploadToBackend()},t.prototype._swipeColorItem=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t.style.backgroundColor;removeClass(this._els.activeColorItem,"_active"),this._els.activeColorItem=t,addClass(t,"_active"),this._updateColor(e)},t.prototype._isColorPickerSupport=function(){if(null!=this._pickerSupport)return this._pickerSupport;var t=document.createElement("input");return t.type="color",t.value="<!>",this._pickerSupport="color"===t.type&&"<!>"!==t.value},t.prototype._onShowBoxDone=function(t,e){this._init(t,e)},t.prototype._getUploadParams=function(t){return{file_name:"photo",file_size_limit:26214400,file_types:"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;",file_types_description:"Image files (*.jpg, *.jpeg, *.png)",clear:1,type:"photo",noFlash:1,max_attempts:3,signed:1,static_url:t.static_url,check_url:t.check_url,base_url:t.base_url,buttonClass:"poster-uploader__select-file",lang:t.lang,onUploadStart:this._onUploadStart.bind(this),onUploadComplete:this._onUploadComplete.bind(this)}},t.prototype._onUploadStart=function(){this._lockUploader()},t.prototype._onUploadComplete=function(t,e,s){var o=this,r=function(){Object(i.d)(getLang("global_error"),getLang("wall_poster_upload_unknown_error")),o._unlockUploader()};try{var n=parseJSON(e);if(this._resultBkg={main_color:n.main_color},n&&n.error)return void r()}catch(t){return void r()}this._sendParams(e,function(t){o._resultBkg=t,o._onSubmitCallback(o._resultBkg),o._unlockUploader(),o.hide()},r)},t.prototype._onColorItemClick=function(t){var e=t.target;hasClass(e,"poster-color-ctrl__gallery-item")&&e!==this._els.pickerItem&&(this._els.pickerItem.style.backgroundColor="",this._swipeColorItem(e))},t.prototype._sendParams=function(t,e,s){ajax.post("al_poster.php",{act:"add_custom_bkg",_query:t,text_color:this._textColor.slice(1)},{onDone:e,onFail:s})},t.prototype._updateText=function(){var t=this._getExampleText&&this._getExampleText(),e=void 0!=this._els.posterTextEl.innerText?"innerText":"textContent";this._els.posterTextEl[e]=t||this._placeholderText},t.prototype._lockUploader=function(){n(this._els.saveBtn),show(this._els.overlay)},t.prototype._unlockUploader=function(){l(this._els.saveBtn),hide(this._els.overlay)},t.prototype._initDragAndDrop=function(){var t=this,e=this._onDragEnter.bind(this),s=this._onDragLeave.bind(this),i=this._onDrop.bind(this);function r(t){t.preventDefault(),t.stopPropagation()}["dragenter","dragover","dragleave","drop"].forEach(function(e){t._els.dropBox.addEventListener(e,r)}),["dragenter","dragover"].forEach(function(s){Object(o.b)(t._els.dropBox,s,e)}),["dragleave","drop"].forEach(function(e){Object(o.b)(t._els.dropBox,e,s)}),Object(o.b)(this._els.dropBox,"drop",i),this._handlersForDestroy.push(function(){["dragenter","dragover","dragleave","drop"].forEach(function(e){t._els.dropBox.removeEventListener(e,r)}),["dragenter","dragover"].forEach(function(s){t._els.dropBox.removeEventListener(s,e)}),["dragleave","drop"].forEach(function(e){t._els.dropBox.removeEventListener(e,s)}),Object(o.h)(t._els.dropBox,"drop",i)})},t.prototype._onDragEnter=function(t){var e=this;this._dragAndDropTimeoutId&&(clearTimeout(this._dragAndDropTimeoutId),cancelEvent(t)),this._dragAndDropTimeoutId=setTimeout(function(){addClass(e._els.dropBox,"dropbox_over")})},t.prototype._onDragLeave=function(t){var e=this;this._dragAndDropTimeoutId&&(clearTimeout(this._dragAndDropTimeoutId),cancelEvent(t)),this._dragAndDropTimeoutId=setTimeout(function(){removeClass(e._els.dropBox,"dropbox_over")},100)},t.prototype._onDrop=function(t){var e=t.dataTransfer.files;this._uploadToModel(e)},t.prototype._onLayerDestroy=function(){this._onHideCallback(),this.destroy()},t.prototype._isFileTypeValid=function(t){return!!t&&"*.jpg;*.JPG;*.jpeg;*.JPEG;*.png;*.PNG;".split(";").some(function(e){return e=e.slice(1),t.substr(-e.length).toLowerCase()===e})},t.prototype.destroy=function(){for(var t=null,e=this._handlersForDestroy||[];t=e.pop();)t();Upload.deinit(this.uploadId)},t}();var c=window,u=c.ce,g=c.se,k=c.geByTag,v=c.domFC,f=c.domNS,m=c.domPS,b=c.domData,y=c.removeClass,w=c.isFunction,B=c.addClass,C=c.hasClass,x=c.attr,I=c.addEvent,M=c.removeEvent,E=c.cancelEvent,T=c.ajax,P=c.setStyle,A=c.hide,H=c.show,L=c.re,S=c.fadeIn,W=c.fadeOut,O=c.animate,j=c.showTooltip,D=c.lockButton,F=c.trim,V=c.buttonLocked,U=c.isObject,z=c.isArray,R=c.parseJSON,N=function(){function t(e,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.state={disabled:!1,opened:!1,toggled:!1},this._flags={isFirstLaunch:!0},this._els={},this._backgroundsMap={},this._categoriesMap={},this._config={constants:e.constants,eventHash:e.events_hash,uploadGen:e.upload_gen,uploadBkgsEnabled:e.custom_enabled,customLayerPlaceholder:e.custom_layer_placeholder},this._options={containerClasses:""},Object.assign(this._options,s),this._prepareConfiguration(e.categories.slice()),this._config.uploadBkgsEnabled&&(this._uploader=new d({onSubmit:this._onCustomBkgAdded.bind(this),onHide:this._onUploaderClose.bind(this),getExampleText:this.getText.bind(this),getPostOwnerId:this._options.getPostOwnerId,placeholder:this._config.customLayerPlaceholder})),this._editorWidth=s.width,this._onChangeData=this._options.onChangeData,this._setFirstBkgByCategoryIdx(0,!0,!0),this._createEditor()}return t.prototype.openEditor=function(){this.state.opened||(this.state.opened=!0,w(this._options.onPreOpen)&&this._options.onPreOpen(),this._flags.isFirstLaunch&&(this._initEditor(),this._flags.isFirstLaunch=!1),this._setBackgroundUrl(this._els.activeBackgroundElem,this._activeBackground),this._loadNearBackgrounds(this._els.activePreviewEl),H(this._els.posterElem),domInsertBefore(this._els.inputMsg,v(this._els.posterView)),this._updateText(),this._autoscrollPreviews(!0),this._onChangeData&&this._onChangeData(),w(this._options.onPostOpen)&&this._options.onPostOpen())},t.prototype.closeEditor=function(){this.state.opened&&(this.state.opened=!1,w(this._options.onPreHide)&&this._options.onPreHide(),A(this._els.posterElem),L(this._els.inputMsg),this._onChangeData&&this._onChangeData(),w(this._options.onPostHide)&&this._options.onPostHide())},t.prototype.isOpen=function(){return this.state.opened},t.prototype.isTextValid=function(t){var e=t.length,s=t.match(/\n/g),i=s?s.length:0;return e<=this._config.constants.max_symbols&&i<=3},t.prototype.isTextFieldValid=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._els.inputMsg;return this.isTextValid(this._getFormatString(t))},t.prototype.isCustomBkgId=function(t){return t&&0!=t.split("_")[0]},t.prototype.checkText=function(){this._onChangeText()},t.prototype.changeBtnText=function(t){this._els.sendBtn.innerHTML=t},t.prototype.focusPoster=function(){this._focusOnInput()},t.prototype.sendStatsInfo=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";(U(e)||z(e))&&(e=JSON.stringify(e)),T.post("al_page.php",{act:"poster_event",type:t,bkg_id:this._activeBackground.id,hash:this._config.eventHash,msg:e})},t.prototype.removeCustomBkg=function(t){if(this.isCustomBkgId(t)){var e=this._backgroundsMap[t],s=this._backgroundsMap[e.id].previewEl;this._nextBkg(!0),L(s),geByClass1("poster__new-bkg",this._els.newBkgBtn).innerHTML=getLang("wall_poster_upload_bkg_btn"),this._customBkg=null,delete this._backgroundsMap[t],delete this._categoriesMap[e.categoryId].bkgs[t]}},t.prototype.addCustomBkg=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.isCustomBkgId(t.id)){this._customBkg&&this.removeCustomBkg(this._customBkg.id),geByClass1("poster__new-bkg",this._els.newBkgBtn).innerHTML=getLang("wall_poster_change_upload_bkg_btn");var s=Object.keys(this._categoriesMap)[0];t.categoryId=s,this._categoriesMap[s].bkgs[t.id]=t,this._backgroundsMap[t.id]=t,this._customBkg=t;var i=this._els.sliderBody,o=this._getPreviewTemplate(t.id),r=g(o);t.previewEl=r,B(r,"poster__slider-item_custom"),i.insertBefore(r,i.firstChild),e&&this.setBkg(t.id,!0)}},t.prototype._onCustomBkgAdded=function(t){this.addCustomBkg(t)},t.prototype._onUploaderClose=function(){w(this._options.onPostUploaderClose)&&this._options.onPostUploaderClose()},t.prototype.nextCategory=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=Object.keys(this._categoriesMap),s=e.indexOf(this._activeCategory.id);s<e.length-1?++s:s=0,this._setFirstBkgByCategoryIdx(s,t),this._onChangeData&&this._onChangeData()},t.prototype.resetPoster=function(){this._customBkg&&this.removeCustomBkg(this._customBkg.id),this._setFirstBkgByCategoryIdx(0,!0)},t.prototype.getPosterElement=function(){return this._els.posterElem},t.prototype.getPostOptionsWrapperEl=function(){return this._els.postOptionsWrapper},t.prototype.getErrorWrapperElement=function(){return this._els.submitErrorView},t.prototype.getTextInputEl=function(){return this._els.inputMsg},t.prototype.getText=function(){return this._text},t.prototype.getTextAsHtml=function(){return this._els.inputMsg.innerHTML},t.prototype.getBkgId=function(){return this._bkgId},t.prototype.getCustomBkg=function(){return this._customBkg},t.prototype.getBtnsWrapper=function(){return this._els.posterBtnsWrapper},t.prototype.setText=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?this._els.inputMsg.innerHTML=t:null!=this._els.inputMsg.innerText?this._els.inputMsg.innerText=t:this._els.inputMsg.textContent=t,this._text=this._getTextFromInput(),this._checkPlaceholder(!0)},t.prototype.setBkg=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t){var s=this._backgroundsMap[t];if(s){var i=this._backgroundsMap[t].previewEl,o=this.isCustomBkgId(this._activeBackground.id);this._setBkgInModel(s.id),y(this._els.activePreviewEl,"poster__slider-item_active"),B(i,"poster__slider-item_active");var r=this._els.activeBackgroundElem,n=this._createBackgroundElem(s);this._els.posterImageContainer.appendChild(n),o&&this._toggleBkgAuthorEl(!1,e),this.isCustomBkgId(t)&&s.author_link&&(this.changeBkgAuthor({authorName:s.author_name,authorUrl:s.author_link},!0),this._toggleBkgAuthorEl(!0,e)),e?(L(r),H(n)):(W(r,250,function(){L(r)}),S(n,250)),this._els.activePreviewEl=i,this._els.activeBackgroundElem=n,this._updateContent(e),this._loadNearBackgrounds(this._els.activePreviewEl),this._onChangeData&&this._onChangeData()}}},t.prototype._setBkgInModel=function(t){this._activeBackground=this._backgroundsMap[t],this._activeCategory=this._categoriesMap[this._activeBackground.categoryId],this._bkgId=t},t.prototype.scrollPreviews=function(t,e){E(t);var s=this._els.sliderBody;if(s.clientWidth!==s.scrollWidth){var i=e||(Math.abs(t.deltaY)>Math.abs(t.deltaX)?t.deltaY:t.deltaX);i<0?this._scrollLeft=Math.max(0,s.scrollLeft+i):s.scrollLeft+s.clientWidth+i<s.scrollWidth?this._scrollLeft=Math.max(0,s.scrollLeft+i):this._scrollLeft=Math.max(0,s.scrollWidth-s.clientWidth),this._applyScroll(s,t,300)&&this._checkSliderSize()}},t.prototype.lockEditPoster=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];x(this._els.inputMsg,"contenteditable",!1),H(this._els.loadingWrapper),t&&D(this._els.sendBtn)},t.prototype.unlockEditPoster=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];x(this._els.inputMsg,"contenteditable",!0),A(this._els.loadingWrapper),t&&unlockButton(this._els.sendBtn)},t.prototype.destroy=function(){this._removeListeners(),Wall.deinitComposer(this._els.inputMsg),L(this._els.posterElem),w(this._options.onDestroy)&&this._options.onDestroy()},t.prototype._initEditor=function(){this._loadImgPreviews(),this._editorWidth||(this._editorWidth=this._options.appendToElem.clientWidth,this._textSizeIdx=null,this._setTextSettings())},t.prototype._nextBkg=function(t){var e=this._els.activePreviewEl,s=f(e);s||(s=v(this._els.sliderBody));var i=b(s,"bkg-id");return this.setBkg(i,t),this.sendStatsInfo("select_bkg"),!1},t.prototype._prevBkg=function(){var t=this._els.activePreviewEl,e=m(t);e||(e=domLC(this._els.sliderBody));var s=b(e,"bkg-id");return this.setBkg(s),this.sendStatsInfo("select_bkg"),!1},t.prototype._createBtnsWrapper=function(){if(this._els.posterBtnsWrapper=g('<div class="poster__btns-wrapper" style="display: none"></div>'),this._config.uploadBkgsEnabled){var t=this._customBkg?getLang("wall_poster_change_upload_bkg_btn"):getLang("wall_poster_upload_bkg_btn");this._els.newBkgBtn=g('\n        <div class="poster__new-bkg-btn-layout" id="poster-new-bkg-btn">\n          <div class="poster__new-bkg-btn-wrapper">\n            <span class="poster__new-bkg">'+t+"</span>\n          </div>\n        </div>\n      "),this._els.posterBtnsWrapper.appendChild(this._els.newBkgBtn)}},t.prototype._autoscrollPreviews=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._backgroundsMap[this._activeBackground.id].previewEl,s=this._els.sliderBody,i=+getComputedStyle(e).marginLeft.slice(0,-2),o=e.clientWidth+2*i,r=vk.rtl?s.scrollWidth-s.clientWidth+e.offsetLeft:e.offsetLeft;this._scrollLeft+37<=r-i&&r+o-i<=this._scrollLeft+s.clientWidth-37?this._checkSliderSize():(this._scrollLeft=Math.max(0,r-i-s.clientWidth/2+o/2),this._applyScroll(s,t)&&this._checkSliderSize())},t.prototype._applyScroll=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600;if(e)t.scrollLeft=this._scrollLeft;else{if(0===this._scrollLeft||this._scrollLeft+t.clientWidth>=t.scrollWidth)return 0===this._scrollLeft?y(this._els.sliderArrowRight,"poster__slider-arrow_disabled"):y(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"),O(t,{scrollLeft:this._scrollLeft},s,this._checkSliderSize.bind(this)),!1;O(t,{scrollLeft:this._scrollLeft},s)}return!0},t.prototype._createPosterElem=function(){this._createPosterViewElem(),this._createAuthorInfoElem(),this._createBtnsWrapper(),this._createPosterErrorView(),this._createToolbarElem(),this._createLoadingWrapper(),this._els.posterElem=g('<div class="poster poster-editor '+this._options.containerClasses+'" style="display: none"></div>'),this._options.appendToElem.appendChild(this._els.posterElem),this._els.posterElem.classList.add("poster","poster-editor"),this._els.posterElem.appendChild(this._els.posterImageContainer),this._els.posterElem.appendChild(this._els.posterView),this._els.posterElem.appendChild(this._els.submitErrorView),this._els.posterElem.appendChild(this._els.posterBtnsWrapper),this._els.posterElem.appendChild(this._els.toolbarWrapper),this._els.posterElem.appendChild(this._els.loadingWrapper)},t.prototype._createToolbarElem=function(){this._els.toolbarWrapper=g('<div class="poster__toolbar-wrapper"></div>'),this._els.toolbar=g('<div class="poster__toolbar"></div>'),this._els.closePosterBtn=g('<div class="poster__close-button"></div>'),this._createSliderElem(),this._createSidebarElem(),this._els.toolbar.appendChild(this._els.closePosterBtn),this._els.toolbar.appendChild(this._els.slider),this._els.toolbar.appendChild(this._els.sidebar),this._els.authorInfoElem&&this._els.toolbarWrapper.appendChild(this._els.authorInfoElem),this._els.toolbarWrapper.appendChild(this._els.toolbar)},t.prototype._createSidebarElem=function(){this._els.sidebar=g('<div class="poster__sidebar"></div>'),this._els.sendBtnWrapper=g('<div class="poster__send-btn-wrapper"></div>'),this._els.sendBtn=g('<button class="poster__send-btn flat_button addpost_button">'+getLang("wall_send")+"</button>"),this._els.sendBtnWrapper.appendChild(this._els.sendBtn),this._els.postOptionsWrapper=g('<div class="poster__settings-btn-wrapper"></div>'),this._els.sidebar.appendChild(this._els.postOptionsWrapper),w(this._options.onCancelClick)&&(this._els.cancelBtnWrapper=g('<div class="poster__cancel-btn-wrapper _cancel-btn"></div>'),this._els.cancelBtn=g('<div class="poster__cancel-btn flat_button wpe_cancel secondary button_light">'+getLang("global_cancel")+"</div>"),this._els.cancelBtnWrapper.appendChild(this._els.cancelBtn),this._els.sidebar.appendChild(this._els.cancelBtnWrapper)),this._els.sidebar.appendChild(this._els.sendBtnWrapper)},t.prototype._createSliderElem=function(){this._els.slider=g('<div class="poster__slider"></div>'),this._els.sliderArrowLeft=g('<div class="poster__slider-arrow _left"></div>'),this._els.sliderBody=g('<div class="poster__slider-body"></div>'),this._els.sliderArrowRight=g('<div class="poster__slider-arrow _right"></div>'),this._createPreviews(),this._els.slider.appendChild(this._els.sliderArrowLeft),this._els.slider.appendChild(this._els.sliderBody),this._els.slider.appendChild(this._els.sliderArrowRight)},t.prototype._createPosterViewElem=function(){this._els.posterView=g('<div class="poster__view"></div>'),this._els.posterImageContainer=g('<div class="poster__image-wrapper"></div>'),this._els.activeBackgroundElem=g('<div class="poster__image" style="background-color: #'+this._activeBackground.main_color+'"></div>'),this._els.changeCategoryBtn=g('<div class="poster__change-bkg-btn">'+this._activeCategory.name+"</div>"),this._els.posterImageContainer.appendChild(this._els.activeBackgroundElem),this._els.posterView.appendChild(this._els.changeCategoryBtn),this._createInputMsgElem(),this._els.posterView.appendChild(this._els.inputMsg),this._els.placeholder&&this._els.posterView.appendChild(this._els.placeholder),this._els.prevArrowWrapperBkg=g('\n      <div class="poster__bkg-arrow-wrapper poster__bkg-arrow_left">\n        <div class="poster__bkg-arrow-shadow"></div>\n      </div>'),this._els.prevArrowBkg=g('<div class="poster__bkg-arrow"></div>'),this._els.prevArrowWrapperBkg.appendChild(this._els.prevArrowBkg),this._els.nextArrowWrapperBkg=g('\n      <div class="poster__bkg-arrow-wrapper poster__bkg-arrow_right">\n        <div class="poster__bkg-arrow-shadow"></div>\n      </div>'),this._els.nextArrowBkg=g('<div class="poster__bkg-arrow"></div>'),this._els.nextArrowWrapperBkg.appendChild(this._els.nextArrowBkg),this._els.posterView.appendChild(this._els.prevArrowWrapperBkg),this._els.posterView.appendChild(this._els.nextArrowWrapperBkg);var t=this._activeBackground,e="#",s="",i="none";this.isCustomBkgId(t.id)&&t.author_link&&(e=t.author_link,s=t.author_name,i="block");var o='<a href="'+e+'" class="poster__author-bkg" style="display: '+i+';" onmouseover="mentionOver(this, { shift: [0, 10, 0] })" target="_blank">\n                    '+s+"\n                  </a>";this._els.bkgAuthorEl=g(o),this._els.posterView.appendChild(this._els.bkgAuthorEl)},t.prototype._createInputMsgElem=function(){this._textSizeIdx=0,this._setTextSettings();var t="#"+this._activeBackground.text_color,e=this._options.prefixId?this._options.prefixId:"";this._els.inputMsg=u("div",{id:e+"poster-field-msg",className:"poster__input-msg"},{fontSize:this._textSettings[this._textSizeIdx].fontSize,lineHeight:this._textSettings[this._textSizeIdx].lineHeight,color:t}),x(this._els.inputMsg,"contenteditable",!0);var s=this._options.placeholder;s&&(this._els.placeholder=g('<div class="poster__placeholder" style="color: '+t+'">'+s+"</div>"))},t.prototype._createAuthorInfoElem=function(){var t=this._options.authorInfoTemplate;t&&(this._els.authorInfoElem=g('<div class="poster__author-info">'+t+"</div>"))},t.prototype._createLoadingWrapper=function(){this._els.loadingWrapper=g('<div class="poster__loading-wrapper"></div>')},t.prototype._createBackgroundElem=function(t){var e=this._getSizeImgIdx(t),s=g('<div class="poster__image" style="display: none; background-color: #'+t.main_color+'"></div>');return null!=e&&P(s,{backgroundImage:"url("+t.urls.main[e].url+")"}),s},t.prototype._createPreviews=function(){var t=this,e=this._els.sliderBody;Object.keys(this._backgroundsMap).forEach(function(s){var i=t._getPreviewTemplate(s),o=g(i);t._backgroundsMap[s].previewEl=o,e.appendChild(o)}),this._els.activePreviewEl=geByClass1("poster__slider-item_active",e)},t.prototype._getPreviewTemplate=function(t){var e=this._backgroundsMap[t],s="";return s+="emoji"===e.categoryId?" poster__slider-item_emoji":"",s+=this._activeBackground.id===e.id?" poster__slider-item_active":"",'<div class="poster__slider-item'+(s+=this.isCustomBkgId(t)?" poster__slider-item_custom":"")+'" data-bkg-id="'+e.id+'" style="background-color: #'+e.main_color+'"></div>'},t.prototype._getFormatString=function(t){if(null!=t.innerText){var e=t.innerText;return"\n"===e.substr(-1)?e.slice(0,-1):e}var s=window.getSelection(),i=null;s.rangeCount&&(i=s.getRangeAt(0));var o=document.createRange();o.selectNodeContents(t),s.removeAllRanges(),s.addRange(o);var r=s.toString();return s.removeAllRanges(),i&&s.addRange(i),r},t.prototype._getTextSizeIdx=function(t){return t>this._config.constants.range_threshold?1:0},t.prototype._getSizeImgIdx=function(t){if(!t||!t.urls)return null;for(var e=this._editorWidth*window.devicePixelRatio,s=0;s<t.urls.main.length;s++){if(t.urls.main[s].width<e)return t.urls.main[s-1]?s-1:s}return t.urls.main.length-1},t.prototype._focusOnInput=function(t,e){e=e||this._els.inputMsg,setTimeout(function(){window.wall.focusOnEnd(e)},0)},t.prototype._checkSliderSize=function(){var t=this._els.sliderBody.scrollWidth,e=this._els.sliderBody.clientWidth,s=this._scrollLeft;if(e!==t){var i=Math.max(0,t-(e+s));0===s?B(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"):y(this._els.sliderArrowLeft,"poster__slider-arrow_disabled"),0===i?B(this._els.sliderArrowRight,"poster__slider-arrow_disabled"):y(this._els.sliderArrowRight,"poster__slider-arrow_disabled")}},t.prototype._checkPlaceholder=function(t){var e=this;if(this._els.placeholder){var s=function(){var t=e._els.inputMsg.textContent;t&&browser.opera&&t.match(/^[ ]+$/)&&(t=""),t||(t=k("br",e._els.inputMsg).length>1),t?(A(e._els.placeholder),P(e._els.inputMsg,{paddingLeft:32,textAlign:"center"})):(H(e._els.placeholder),P(e._els.inputMsg,{paddingLeft:e._els.placeholder.offsetLeft,textAlign:"left"}))};t?s():setTimeout(s,100)}},t.prototype._loadNearBackgrounds=function(t){var e=this;setTimeout(function(){var s=m(t),i=f(t);s&&(e._loadBackgroundImageByPreview(s),s=m(s)),s&&e._loadBackgroundImageByPreview(s),i&&(e._loadBackgroundImageByPreview(i),i=f(i)),i&&e._loadBackgroundImageByPreview(i)},0)},t.prototype._loadBackgroundImageByPreview=function(t){var e=b(t,"bkg-id"),s=this._backgroundsMap[e],i=this._getSizeImgIdx(s);(new Image).src=s.urls.main[i].url},t.prototype._onChangeText=function(t){var e=w(this._options.onOverTextLimit);if(t&&"input"!=t.type||!e){if(t&&"keypress"==t.type&&!e){var s=t.which,i=String.fromCharCode(s);13==s&&(i="\n");var o=i+this._getTextFromInput();return!!this.isTextValid(o)||(E(t),!1)}}else if(!this.isTextFieldValid())return void this._options.onOverTextLimit();this._updateText(),this._onChangeData&&this._onChangeData()},t.prototype._getTextFromInput=function(){return this._getFormatString(this._els.inputMsg)},t.prototype._updateTextSize=function(){var t=this._getTextFromInput(),e=this._getTextSizeIdx(t.length);e!==this._textSizeIdx&&(this._textSizeIdx=e,P(this._els.inputMsg,{fontSize:this._textSettings[e].fontSize,lineHeight:this._textSettings[e].lineHeight}))},t.prototype._createPosterErrorView=function(){this._els.submitErrorView=g('<div class="poster__submit-error"></div>')},t.prototype._createLoadingWrapper=function(){this._els.loadingWrapper=g('<div class="poster__loading-wrapper"></div>')},t.prototype._onPosterViewMouseenter=function(){B(this._els.posterView,"poster__view_hover")},t.prototype._onNextCategoryBtnClick=function(){this.nextCategory(),this.sendStatsInfo("select_category")},t.prototype._onPosterViewMouseout=function(t){0==t.screenX&&0==t.screenY||y(this._els.posterView,"poster__view_hover")},t.prototype._initListeners=function(){this._closePosterBtnClickHandler=this._onCloseBtnClick.bind(this),this._changeCategoryBtnClickHandler=this._onNextCategoryBtnClick.bind(this),this._sliderBodyWheelHandler=this.scrollPreviews.bind(this),this._sliderArrowRightClickHandler=this.scrollPreviews.bind(this,null,151),this._sliderArrowLeftClickHandler=this.scrollPreviews.bind(this,null,-151),this._posterViewClickHandler=this._onPosterViewClick.bind(this),this._sendBtnClickHandler=this._send.bind(this),this._inputMsgInputHandler=this._onChangeText.bind(this),this._hotKeyKeydownHandler=this._hotKeyHandler.bind(this),this._inputMsgPasteHandler=this._onPasteText.bind(this),this._inputMsgMouseHandler=this._checkMouseSelection.bind(this),this._inputMsgKeypressHandler=this._onChangeText.bind(this),w(this._options.onOverTextLimit)||I(this._els.inputMsg,"keypress",this._inputMsgKeypressHandler),this._inputMsgPlaceholderFocus=this._checkPlaceholder.bind(this),this._inputMsgPlaceholderBlur=this._checkPlaceholder.bind(this),this._inputMsgPlaceholderInput=this._checkPlaceholder.bind(this),this._nextBkgBtnClickHandler=vk.rtl?this._prevBkg.bind(this,!1):this._nextBkg.bind(this,!1),this._prevBkgBtnClickHandler=vk.rtl?this._nextBkg.bind(this,!1):this._prevBkg.bind(this,!1),this._posterViewMouseenterHandler=this._onPosterViewMouseenter.bind(this),this._posterViewMouseleaveHandler=this._onPosterViewMouseout.bind(this),this._arrowBkgMouseenterHandler=this._toggleBkgArrowHover.bind(this,!0),this._arrowBkgMouseleaveHandler=this._toggleBkgArrowHover.bind(this,!1),this._sliderClickHandler=this._onPreviewItemClick.bind(this),this._sliderMousedownHandler=this._saveFocus.bind(this);var t=j.bind(this._els.closePosterBtn,this._els.closePosterBtn,{text:getLang("wall_poster_close"),black:1,shift:[5,-10]});this._closePosterBtnMouseoverHandler=t,I(this._els.posterView,"mouseenter",this._posterViewMouseenterHandler),I(this._els.posterView,"mouseleave",this._posterViewMouseleaveHandler),I(this._els.nextArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),I(this._els.prevArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),I(this._els.nextArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),I(this._els.prevArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),I(this._els.nextArrowWrapperBkg,"mousedown",this._nextBkgBtnClickHandler),I(this._els.prevArrowWrapperBkg,"mousedown",this._prevBkgBtnClickHandler),I(this._els.closePosterBtn,"click",this._closePosterBtnClickHandler),I(this._els.closePosterBtn,"mouseover",this._closePosterBtnMouseoverHandler),I(this._els.changeCategoryBtn,"mousedown",this._changeCategoryBtnClickHandler),I(this._els.sliderBody,browserFeatures.wheelEvent,this._sliderBodyWheelHandler),I(this._els.sliderBody,"click",this._sliderClickHandler),I(this._els.sliderBody,"mousedown",this._sliderMousedownHandler),I(this._els.sliderArrowRight,"click",this._sliderArrowRightClickHandler),I(this._els.sliderArrowLeft,"click",this._sliderArrowLeftClickHandler),I(this._els.posterView,"click",this._posterViewClickHandler),I(this._els.inputMsg,"input",this._inputMsgInputHandler),I(this._els.inputMsg,"keydown",this._hotKeyKeydownHandler),I(this._els.inputMsg,"paste",this._inputMsgPasteHandler),I(this._els.inputMsg,"mousedown mouseup",this._inputMsgMouseHandler),I(this._els.closePosterBtn,"mousedown",this._saveFocus.bind(this)),I(this._els.changeCategoryBtn,"mousedown",this._saveFocus.bind(this)),I(this._els.sliderArrowRight,"mousedown",this._saveFocus.bind(this)),I(this._els.sliderArrowLeft,"mousedown",this._saveFocus.bind(this)),I(this._els.sidebar,"mousedown",this._saveFocus.bind(this)),I(this._els.sendBtn,"click",this._sendBtnClickHandler),this._config.uploadBkgsEnabled&&I(this._els.newBkgBtn,"click",this._openUploader.bind(this)),w(this._options.onCancelClick)&&I(this._els.cancelBtn,"click",this._options.onCancelClick),this._els.placeholder&&(I(this._els.inputMsg,"focus",this._inputMsgPlaceholderFocus),I(this._els.inputMsg,"input",this._inputMsgPlaceholderInput),I(this._els.inputMsg,"blur",this._inputMsgPlaceholderBlur))},t.prototype._removeListeners=function(){M(this._els.posterView,"mouseenter",this._posterViewMouseenterHandler),M(this._els.posterView,"mouseleave",this._posterViewMouseleaveHandler),M(this._els.nextArrowWrapperBkg,"mousedown",this._nextBkgBtnClickHandler),M(this._els.prevArrowWrapperBkg,"mousedown",this._prevBkgBtnClickHandler),M(this._els.nextArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),M(this._els.prevArrowWrapperBkg,"mouseenter",this._arrowBkgMouseenterHandler),M(this._els.nextArrowWrapperBkg,"mouseleave",this._arrowBkgMouseenterHandler),M(this._els.prevArrowWrapperBkg,"mouseleave",this._arrowBkgMouseleaveHandler),M(this._els.closePosterBtn,"click",this._closePosterBtnClickHandler),M(this._els.closePosterBtn,"mouseover",this._closePosterBtnMouseoverHandler),M(this._els.changeCategoryBtn,"mousedown",this._changeCategoryBtnClickHandler),M(this._els.sliderBody,"wheel",this._sliderBodyWheelHandler),M(this._els.sliderBody,"click",this._sliderClickHandler),M(this._els.sliderBody,"mousedown",this._sliderMousedownHandler),M(this._els.sliderArrowRight,"click",this._sliderArrowRightClickHandler),M(this._els.sliderArrowLeft,"click",this._sliderArrowLeftClickHandler),M(this._els.posterView,"click",this._posterViewClickHandler),M(this._els.sendBtn,"click",this._sendBtnClickHandler),M(this._els.inputMsg,"input keydown",this._inputMsgInputHandler),M(this._els.inputMsg,"paste",this._inputMsgPasteHandler),M(this._els.inputMsg,"mousedown mouseup",this._inputMsgMouseHandler),w(this._options.onOverTextLimit)||M(this._els.inputMsg,"keypress",this._inputMsgKeypressHandler),M(this._els.closePosterBtn,"mousedown",this._saveFocus.bind(this)),M(this._els.changeCategoryBtn,"mousedown",this._saveFocus.bind(this)),M(this._els.sliderArrowRight,"mousedown",this._saveFocus.bind(this)),M(this._els.sliderArrowLeft,"mousedown",this._saveFocus.bind(this)),M(this._els.sidebar,"mousedown",this._saveFocus.bind(this)),this._config.uploadBkgsEnabled&&M(this._els.newBkgBtn,"click",this._openUploader.bind(this)),w(this._options.onCancelClick)&&M(this._els.cancelBtn,"click",this._options.onCancelClick),this._els.placeholder&&(M(this._els.inputMsg,"focus",this._inputMsgPlaceholderFocus),M(this._els.inputMsg,"input",this._inputMsgPlaceholderInput),M(this._els.inputMsg,"blur",this._inputMsgPlaceholderBlur))},t.prototype._openUploader=function(){this._uploader&&(w(this._options.onPreUploaderOpen)&&this._options.onPreUploaderOpen(),this._uploader.show())},t.prototype._onPosterViewClick=function(t){t.target==t.currentTarget&&this._focusOnInput()},t.prototype._checkMouseSelection=function(t){"mousedown"==t.type?(P(this._els.nextArrowWrapperBkg,{pointerEvents:"none"}),P(this._els.prevArrowWrapperBkg,{pointerEvents:"none"})):"mouseup"==t.type&&(P(this._els.nextArrowWrapperBkg,{pointerEvents:"auto"}),P(this._els.prevArrowWrapperBkg,{pointerEvents:"auto"}))},t.prototype._createEditor=function(){this._createPosterElem(),this._initListeners(),cur.destroy.push(this.destroy.bind(this)),Wall.initComposer(this._els.inputMsg,{lang:{introText:getLang("profile_mention_start_typing"),noResult:getLang("profile_mention_not_found")},appendTo:this._insertComposer.bind(this),poster:this})},t.prototype._updateContent=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e="#"+this._activeBackground.text_color,s=this._activeCategory.name;this._els.changeCategoryBtn.innerHTML!==s&&(this._els.changeCategoryBtn.innerHTML=s),P(this._els.inputMsg,{color:e}),P(this._els.placeholder,{color:e}),this._onChangeText(),this._autoscrollPreviews(t)},t.prototype._insertComposer=function(t){t&&window.domInsertAfter(t,this._els.posterView)},t.prototype._loadImgPreviews=function(){for(var t=this._els.sliderBody.children,e=/.([a-z-]{3,5})((\?.*)?$)/,s=window.devicePixelRatio,i=0;i<t.length;i++){var o=t[i],r=b(o,"bkg-id"),n=this._backgroundsMap[r],l=s>1&&n.preview?n.preview.replace(e,"_2x.$1$2"):n.preview,a=n.preview?"background":"backgroundColor";o.style[a]=n.preview?"url('"+l+"') no-repeat 50% / cover":"#"+n.main_color}},t.prototype._onPreviewItemClick=function(t){if(!C(t.target,"poster__slider-item"))return!1;var e=t.target,s=b(e,"bkg-id");if(this._activeBackground.id===s)return!1;this.setBkg(s),this.sendStatsInfo("select_bkg"),this._onChangeData&&this._onChangeData()},t.prototype._onCloseBtnClick=function(t){this.sendStatsInfo("close"),this.closeEditor(t),E(t)},t.prototype._onPasteText=function(t){var e=Emoji.getClipboard(t),s=e+this._getTextFromInput();if(!this.isTextValid(s)&&!w(this._options.onOverTextLimit))return E(t),!1;e=e.replace(/\n/g,"<br/>");var i=u("div",{innerHTML:e});Emoji.insertHTML(i.innerHTML),t&&this._onChangeData&&this._onChangeData(),E(t)},t.prototype._hotKeyHandler=function(t){if(!this.state.opened||this.state.toggled)return!1;t.ctrlKey&&t.keyCode==KEY.ENTER&&this._send(),t.ctrlKey||t.keyCode!=KEY.ESC||this._onCloseBtnClick(t)},t.prototype._send=function(){var t=this._bkgId,e=F(this._text),s=encodeURIComponent(e),i=this._backgroundsMap[t].access_hash;if(e.length&&!V(this._els.sendBtn)){if(this.lockEditPoster(),this._config.uploadGen){var o=this,r=this._config.uploadGen+"&bkg_access_hash="+i+"&text="+s+"&bkg_id="+t+"&ajx=1",n=new XMLHttpRequest,l=1e3*this._config.constants.upload_gen_timeout||4e3,a=!1;n.open("POST",r,!0);n.onreadystatechange=function(){if(4==this.readyState&&!a){var s,n=null,l=R(this.responseText);200===this.status&&((s=l)&&s.owner_id&&s.id&&s.post_hash)?n=l:o.sendStatsInfo("upload_failed",extend(l||{},{status:this.status,statusText:this.statusText,responseText:l?"":this.responseText,urlUploadFail:r})),o._options.onSend({text:e,bkgId:t,fallbackObj:n,accessHash:i}),clearTimeout(p)}};var p=setTimeout(function(){o.sendStatsInfo("upload_timeout"),o._options.onSend({text:e,bkgId:t,accessHash:i}),a=!0,n.abort()},l);n.send()}else this._options.onSend({text:e,bkgId:t,accessHash:i});return!0}},t.prototype._setFirstBkgByCategoryIdx=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Object.keys(this._categoriesMap)[t],o=this._categoriesMap[i],r=this._customBkg&&0===t?this._customBkg.id:Object.keys(o.bkgs)[0];s?this._setBkgInModel(r):this.setBkg(r,e)},t.prototype._setBackgroundUrl=function(t,e){var s=this._getSizeImgIdx(e);null!=s&&P(t,{backgroundImage:"url("+this._activeBackground.urls.main[s].url+")"})},t.prototype._setTextSettings=function(){this._textSettings=[{fontSize:Math.round(this._config.constants.font_size_ratio_range_1*this._editorWidth)+"px",lineHeight:Math.round(this._config.constants.line_height_ratio_range_1*this._editorWidth)+"px"},{fontSize:Math.round(this._config.constants.font_size_ratio_range_2*this._editorWidth)+"px",lineHeight:Math.round(this._config.constants.line_height_ratio_range_2*this._editorWidth)+"px"}]},t.prototype._saveFocus=function(){var t=geByClass1("post_action_btn_layout",this._els.postAvailableBtn),e=geByClass1("post_action_btn_layout",this._els.postponeBtn);t&&data(t,"ett").hide();e&&data(e,"ett").hide();return!1},t.prototype._updateText=function(){this._text=this._getTextFromInput(),this._checkPlaceholder(),this._updateTextSize()},t.prototype._toggleBkgArrowHover=function(t,e){if(0!=e.screenX||0!=e.screenY){var s=e.currentTarget;C(s,"poster__bkg-arrow_right")?(toggleClass(this._els.nextArrowWrapperBkg,"poster__bkg-arrow_hovered",t),toggleClass(this._els.prevArrowWrapperBkg,"poster__bkg-arrow_faded",t)):C(s,"poster__bkg-arrow_left")&&(toggleClass(this._els.prevArrowWrapperBkg,"poster__bkg-arrow_hovered",t),toggleClass(this._els.nextArrowWrapperBkg,"poster__bkg-arrow_faded",t))}},t.prototype._toggleBkgAuthorEl=function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t?e?H(this._els.bkgAuthorEl):S(this._els.bkgAuthorEl,250,function(){w(s)&&s()}):e?A(this._els.bkgAuthorEl):W(this._els.bkgAuthorEl,250,function(){w(s)&&s()})},t.prototype.changeBkgAuthor=function(t){var e=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t.authorUrl&&t.authorName&&this._customBkg){var i=function(){e._els.bkgAuthorEl.href=t.authorUrl,e._els.bkgAuthorEl.innerHTML=getLang("wall_poster_author_custom_bkg").replace("{author_name}",t.authorName),x(e._els.bkgAuthorEl,"mention_id",t.authorUrl.substr(1)),s||e._toggleBkgAuthorEl(),e._els.bkgAuthorEl.tt&&w(e._els.bkgAuthorEl.tt.destroy)&&e._els.bkgAuthorEl.tt.destroy()};s?i():this._toggleBkgAuthorEl(!1,!1,i),this._customBkg.author_link=t.authorUrl,this._customBkg.author_name=t.authorName,this._onChangeData&&this._onChangeData()}},t.prototype._prepareConfiguration=function(t){var e=this;t.forEach(function(t){var s={};t.bkgs.forEach(function(i){s[i.id]=i,s[i.id].categoryId=t.id,e.isCustomBkgId(i.id)&&(e._customBkg=i)}),e._categoriesMap[t.id]=t,e._categoriesMap[t.id].bkgs=s,Object.assign(e._backgroundsMap,s)})},t}();window.Poster=N;try{stManager.done(jsc("web/poster.js"))}catch(t){}}});